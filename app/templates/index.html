{% extends 'base.html' %}

{% block title %}Home - MyMarket{% endblock %}

{% block content %}
<div class="container mx-auto mt-10 flex flex-col justify-center p-3 space-y-3">
  <div class="bg-gray-700 p-6 rounded-lg shadow-lg">
    <div class="container mx-auto p-4">
      <h1 class="text-3xl font-bold mb-6">AI Analysis</h1>
      <p>{{ gpt_summary }}</p>
    </div>
  </div>

  {% if graphs %}
    {% for graph in graphs %}
      <div class="bg-gray-700 p-6 rounded-lg shadow-lg">
        <div class="container mx-auto p-4">
          <h1 class="text-3xl font-bold mb-6">{{ graph.title }}</h1>
          <canvas id="{{ graph.id }}" style="width: 100%;"></canvas>
        </div>
      </div>
    {% endfor %}
  {% else %}
      <p>Could not load charts.</p>
  {% endif %}

  <!-- <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <div class="bg-gray-700 p-6 rounded-lg shadow-lg">
          <img src="https://via.placeholder.com/400x200" alt="Sample Image 2" class="rounded-t-lg">
          <div class="mt-4">
              <h2 class="text-xl font-bold">Card Title 2</h2>
              <p class="mt-2 text-gray-300">This is a sample text for the second card. It contains some placeholder text and an image.</p>
          </div>
      </div>
  </div> -->
</div>

<script>
  const graphs = {{ graphs|tojson|safe }};

  graphs.forEach(graph => {
    const canvasId = graph.id;
    const graphData = graph.data
    const color = graph.color

    const dates = graphData.map(item => formatDate(item.Date));
    const prices = graphData.map(item => item.Close);

    try {
      const ctx = document.getElementById(canvasId).getContext("2d");
      let lineChart = new Chart(ctx, {
          type: 'line',
          data: {
              labels: dates,
              datasets: [{
                  label: 'Closing Price',
                  data: prices,
                  fill: false,
                  borderColor: color,
                  borderWidth: 1
              }]
          }
      });
    } catch (e) {
      alert(e)
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }
  });
</script>

{% endblock %}